<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>How to Configure ColorSpace Allocation</title>
    
      <link rel="stylesheet" href="../_static/pygments.css">
      <link rel="stylesheet" href="../_static/theme.css">
      <link rel="stylesheet" href="../_static/sphinx_press_theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>

      
      <script src="../_static/theme-vendors.js"></script>
      <script src="../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="next" title="Config syntax" href="config_syntax.html" />
  <link rel="prev" title="aces_1.0.3" href="aces_1.0.3.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../index.html" class="home-link">
    
      <img class="logo" src="../_static/OpenColorIO_withText.svg" alt="doit logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../overview/_index.html#"
         class="nav-link ">
         Overview
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../users/_index.html#user-guide"
         class="nav-link ">
         User Guide
      </a>
    </div>
  
    <div class="nav-item">
      <a href="_index.html#public-configs"
         class="nav-link  router-link-active">
         Configs
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../api/_index.html#api"
         class="nav-link ">
         API
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../contributors/_index.html#"
         class="nav-link ">
         Contributors
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://github.com/AcademySoftwareFoundation/OpenColorIO"
        class="nav-link external">
          Github <outboundlink/>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../overview/_index.html#"
         class="nav-link ">
         Overview
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../users/_index.html#user-guide"
         class="nav-link ">
         User Guide
      </a>
    </div>
  
    <div class="nav-item">
      <a href="_index.html#public-configs"
         class="nav-link  router-link-active">
         Configs
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../api/_index.html#api"
         class="nav-link ">
         API
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../contributors/_index.html#"
         class="nav-link ">
         Contributors
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://github.com/AcademySoftwareFoundation/OpenColorIO"
        class="nav-link external">
          Github <outboundlink/>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../overview/_index.html#">Overview</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../overview/compatible_software.html" class="reference internal ">Compatible Software</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../overview/downloads.html" class="reference internal ">Downloads</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../overview/faq.html" class="reference internal ">FAQ</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../overview/installation.html" class="reference internal ">Installation</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../overview/introduction.html" class="reference internal ">Introduction</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../overview/license.html" class="reference internal ">License</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../users/_index.html#user-guide">User Guide</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../users/tool_overview.html" class="reference internal ">Tool overview</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../users/baking_luts.html" class="reference internal ">Baking LUT’s</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="_index.html#public-configs">Configs</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="spi_vfx.html" class="reference internal ">spi-vfx</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="spi_anim.html" class="reference internal ">spi-anim</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="nuke_default.html" class="reference internal ">nuke-default</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="aces_1.0.3.html" class="reference internal ">aces_1.0.3</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">How to Configure ColorSpace Allocation</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#how-to-configure-colorspace-allocation" class="reference internal">How to Configure ColorSpace Allocation</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 "><a href="config_syntax.html" class="reference internal ">Config syntax</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="contexts.html" class="reference internal ">Contexts</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="looks.html" class="reference internal ">Looks</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../api/_index.html#api">API</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../api/change_log.html" class="reference internal ">ChangeLog</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../api/c_baker.html" class="reference internal ">Baker</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../api/c_context.html" class="reference internal ">Context</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../api/c_gpushadercreator.html" class="reference internal ">GpuShaderCreator</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../api/c_gpushaderdesc.html" class="reference internal ">GpuShaderDesc</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../api/c_imagedesc.html" class="reference internal ">ImageDesc</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../api/c_packedimagedesc.html" class="reference internal ">PackedImageDesc</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../api/c_planarimagedesc.html" class="reference internal ">PlanarImageDesc</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../contributors/_index.html#">Contributors</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../contributors/getting_started.html" class="reference internal ">Getting started</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../contributors/coding_guidelines.html" class="reference internal ">Coding guidelines</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../contributors/documentation_guidelines.html" class="reference internal ">Documentation guidelines</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../contributors/internal_architecture.html" class="reference internal ">Internal Architecture Overview</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../contributors/issues.html" class="reference internal ">Issues</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../contributors/submitting_changes.html" class="reference internal ">Submitting Changes</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../contributors/usage_examples.html" class="reference internal ">Usage Examples</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      <li><a href="_index.html">Configurations</a> &raquo;</li>
    
    <li>How to Configure ColorSpace Allocation</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="aces_1.0.3.html"
       title="previous chapter">← aces_1.0.3</a>
  </li>
  <li class="next">
    <a href="config_syntax.html"
       title="next chapter">Config syntax →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <div class="section" id="how-to-configure-colorspace-allocation">
<span id="allocationvars"></span><h1>How to Configure ColorSpace Allocation<a class="headerlink" href="#how-to-configure-colorspace-allocation" title="Permalink to this headline">¶</a></h1>
<p>The allocation / allocation vars are utilized using during GPU 3dlut / shader
text generation. (Processor::getGpuShaderText, Processor::getGpuLut3D).</p>
<p>If, in the course of GPU processing, a 3D lut is required, the “allocation /
allocation vars” direct how OCIO should sample the colorspace, with the intent
being to maintain maximum fidelity and minimize clamping.</p>
<p>Currently support allocations / variables:</p>
<dl class="simple">
<dt>ALLOCATION_UNIFORM::</dt><dd><p>2 vars: [min, max]</p>
</dd>
<dt>ALLOCATION_LG2::</dt><dd><p>2 vars: [lg2min, lg2max]
3 vars: [lg2min, lg2max, linear_offset]</p>
</dd>
</dl>
<p>So say you have an srgb image (such as an 8-bit tif), where you know the data
ranges between 0.0 - 1.0 (after converting to float).  If you wanted to apply
a 3d lut to this data, there is no danger in sampling that space uniformly and
clamping data outside (0,1).   So for this colorspace we would tag it:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">allocation</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">uniform</span>
<span class="nt">allocationvars</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span> <span class="nv">1.0</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>These are the defaults, so the tagging could also be skipped.</p>
<p>But what if you were actually first processing the data, where occasionally
small undershoot and overshoot values were encountered? If you wanted OCIO to
preserve this overshoot / undershoot pixel information, you would do so by
modifying the allocation vars.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">allocation</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">uniform</span>
<span class="nt">allocationvars</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">-0.125</span><span class="p p-Indicator">,</span> <span class="nv">1.125</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>This would mean that any image data originally within [-0.125, 1.125] will be
preserved during GPU processing.  (Protip: Data outside this range <em>may</em>
actually be preserved in some circumstances - such as if a 3d lut is not needed
- but it’s not required to be preserved).</p>
<p>So why not leave this at huge values (such as [-1000.0, 1000.0]) all the time?
Well, there’s a cost to supporting this larger dynamic range, and that cost is
reduced precision within the 3D luts sample space.   So in general you’re best
served by using sensible allocations (the smallest you can get away with, but
no smaller).</p>
<p>Now in the case of high-dynamic range color spaces (such as float linear), a
uniform sampling is not sufficient because the max value we need to preserve is
so high.</p>
<p>Say you were using a 32x32x32 3d lookup table (a common size).  Middle gray is
at 0.18, and specular values are very much above that.  Say the max value we
wanted to preserve in our coding space is 256.0, each 3d lut lattice coordinates
would represent 8.0 units of linear light! That means the vast majority of the
perceptually significant portions of the space wouldn’t be sampled at all!</p>
<p>unform allocation from 0-256:
0
8.0
16.0
…
240.0
256.0</p>
<p>So another allocation is defined, lg2</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="kt">!&lt;ColorSpace&gt;</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">linear</span>
  <span class="nt">description</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">Scene-linear, high dynamic range. Used for rendering and compositing.</span>
  <span class="nt">allocation</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lg2</span>
  <span class="nt">allocationvars</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">-8</span><span class="p p-Indicator">,</span> <span class="nv">8</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>In this case, we’re saying that the appropriate ways to sample the 3d lut are
logarithmically, from 2^-8 stops to 2^8 stops.</p>
<p>Sample locations:
2^-8: 0.0039
2^-7: 0.0078
2^-6: 0.0156
…
2^0:  1.0
…
2^6:  64.0
2^7:  128.0
2^8:  256.0</p>
<p>Which gives us a much better perceptual sampling of the space.</p>
<p>The one downside of this approach is that it can’t represent 0.0,
which is why we optionally allow a 3d allocation var, a black point
offset.  If you need to preserve 0.0 values, and you have a high
dynamic range space, you can specify a small offset.</p>
<p>Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">allocation</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lg2</span>
<span class="nt">allocationvars</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">-8</span><span class="p p-Indicator">,</span> <span class="nv">8</span><span class="p p-Indicator">,</span> <span class="nv">0.00390625</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The [-15.0, 6.0] values in spi-vfx come from the fact that all of the
linearizations provided in that profile span the region from 2^-15
stops, to 2^6 stops.   One could probably change that black point to a
higher number (such as -8), but if you raised it too much you would
start seeing black values be clipped.   Conversely, on the high end
one could raise it a bit but if you raised it too far the precision
would suffer around gray, and if you lowered it further you’d start to
see highlight clipping.</p>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="aces_1.0.3.html"
       title="previous chapter">← aces_1.0.3</a>
  </li>
  <li class="next">
    <a href="config_syntax.html"
       title="next chapter">Config syntax →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright Contributors to the OpenColorIO Project.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>